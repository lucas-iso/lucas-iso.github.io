<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Fiscal Week Generator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    label, input {
      margin: 10px 0;
      display: block;
    }
    button {
      margin-top: 20px;
      padding: 10px 15px;
    }
  </style>
</head>
<body>
  <h2>Fiscal Week CSV Generator</h2>

  <label for="startYear">Start Year:</label>
  <input type="number" id="startYear" min="2000" max="2100">

  <label for="endYear">End Year:</label>
  <input type="number" id="endYear" min="2000" max="2100">

  <button onclick="generateCSV()">Generate CSV</button>

  <script>
    // Load saved years from localStorage
    window.onload = function () {
      const savedStart = localStorage.getItem('startYear');
      const savedEnd = localStorage.getItem('endYear');
      if (savedStart) document.getElementById('startYear').value = savedStart;
      if (savedEnd) document.getElementById('endYear').value = savedEnd;
    };

    // Helper: Get last Monday of May for a given year
    function getLastMondayOfMay(year) {
      const date = new Date(year, 4, 31); // May 31
      while (date.getDay() !== 1) { // 1 = Monday
        date.setDate(date.getDate() - 1);
      }
      return date;
    }

    // Helper: Format date as YYYY-MM-DD HH:mm:ss
    function formatDate(date) {
      return date.toISOString().split('T')[0] + ' 00:00:00';
    }

    // Main function to generate CSV
    function generateCSV() {
      const startYear = parseInt(document.getElementById('startYear').value);
      const endYear = parseInt(document.getElementById('endYear').value);

      if (isNaN(startYear) || isNaN(endYear) || startYear > endYear) {
        alert("Please enter valid years.");
        return;
      }

      // Save to localStorage
      localStorage.setItem('startYear', startYear);
      localStorage.setItem('endYear', endYear);

      let csv = "Shipper Week #,Fiscal Year,Week Start Date,Week End Date\n";

      for (let fiscalYear = startYear; fiscalYear <= endYear; fiscalYear++) {
        let startDate = getLastMondayOfMay(fiscalYear - 1); // Fiscal year starts in previous calendar year
        for (let week = 1; week <= 52; week++) {
          let endDate = new Date(startDate);
          endDate.setDate(startDate.getDate() + 6);

          csv += `${week},${fiscalYear},${formatDate(startDate)},${formatDate(endDate)}\n`;

          // Move to next week
          startDate.setDate(startDate.getDate() + 7);
        }
      }

      // Download CSV
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'fiscal_weeks.csv';
      a.click();
      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>